<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Star Citizen RPG Tool</title>
  <style>
    :root {
      --color-space: #0a0e17;
      --color-primary: #00a2ff;
      --color-secondary: #7b3fe4;
      --color-danger: #ff3860;
      --color-warning: #ff9f43;
      --color-success: #2ecc71;
      --color-epic: #b56cff;
    }
    body {
      font-family: 'Orbitron', 'Arial', sans-serif;
      background: var(--color-space);
      color: #e0e0e0;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      background-image: radial-gradient(circle at 50% 50%, #1a2a4a 0%, var(--color-space) 100%);
    }
    .container {
      background: rgba(10, 20, 40, 0.8);
      border-radius: 10px;
      padding: 25px;
      border: 1px solid var(--color-primary);
      box-shadow: 0 0 20px rgba(0, 162, 255, 0.2);
    }
    h1 {
      color: var(--color-primary);
      text-align: center;
      text-shadow: 0 0 10px rgba(0, 162, 255, 0.5);
      letter-spacing: 1px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: var(--color-primary);
      font-weight: bold;
    }
    input {
      width: 96%;
      padding: 12px;
      background: rgba(20, 30, 50, 0.7);
      border: 1px solid var(--color-primary);
      border-radius: 5px;
      color: white;
      font-family: 'Orbitron', sans-serif;
    }
    select {
      width: 100%;
      padding: 12px;
      background: rgba(20, 30, 50, 0.7);
      border: 1px solid var(--color-primary);
      border-radius: 5px;
      color: white;
      font-family: 'Orbitron', sans-serif;
    }
    button {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: white;
      border: none;
      padding: 15px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: all 0.3s;
    }
    button:hover {
      background: linear-gradient(135deg, #0088cc, #6b2fc9);
      box-shadow: 0 0 15px rgba(0, 162, 255, 0.5);
    }
    #result {
      margin-top: 25px;
      padding: 20px;
      border-radius: 5px;
      background: rgba(30, 40, 70, 0.6);
      border-left: 4px solid var(--color-primary);
      display: none;
    }
    .critical { color: var(--color-danger); border-color: var(--color-danger); }
    .failure { color: var(--color-warning); border-color: var(--color-warning); }
    .partial { color: #ffcc00; border-color: #ffcc00; }
    .success { color: var(--color-success); border-color: var(--color-success); }
    .epic { color: var(--color-epic); border-color: var(--color-epic); }
    .skill-icon {
      font-size: 1.2em;
      margin-right: 5px;
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>üåü STAR CITIZEN RPG TOOL</h1>
    
    <div id="webhook-form">
      <h3>‚öô CONFIGURACI√ìN DEL SISTEMA</h3>
      <div class="form-group">
        <label for="webhook-url">ENLACE DE DISCORD WEBHOOK:</label>
        <input type="password" id="webhook-url" placeholder="https://discord.com/api/webhooks/...">
      </div>
      <button onclick="guardarWebhook()">INICIAR SISTEMA</button>
    </div>
    
    <div id="dados-section" style="display: none;">
      <h2>üöÄ SIMULADOR DE HABILIDADES</h2>
      <div class="form-group">
        <label for="character-name">NOMBRE DEL PILOTO/TRIPULANTE:</label>
        <input type="text" id="character-name" placeholder="Ej: CMDR Shepard">
      </div>
      <div class="form-group">
        <label for="skill-name">HABILIDAD:</label>
        <select id="skill-name">
          <option value="Piloto ‚úàÔ∏è">Piloto ‚úàÔ∏è</option>
          <option value="Combate üî´">Combate üî´</option>
          <option value="T√©cnico üõ†Ô∏è">T√©cnico üõ†Ô∏è</option>
          <option value="Carisma üó£Ô∏è">Carisma üó£Ô∏è</option>
          <option value="Supervivencia üåç">Supervivencia üåç</option>
          <option value="Comercio üì¶">Comercio üì¶</option>
        </select>
      </div>
      <div class="form-group">
        <label for="skill-points">NIVEL DE HABILIDAD (1-6):</label>
        <input type="number" id="skill-points" min="1" max="6" value="3">
      </div>
      <button onclick="tirarDados()">‚ö° EJECUTAR SIMULACI√ìN</button>
      
      <div id="result"></div>
    </div>
  </div>

  <script>
    // Verificar configuraci√≥n existente
    const webhookURL = localStorage.getItem('discordWebhookURL');
    if (webhookURL) {
      document.getElementById('webhook-form').style.display = 'none';
      document.getElementById('dados-section').style.display = 'block';
    }

    function guardarWebhook() {
      const url = document.getElementById('webhook-url').value.trim();
      
      if (!url.startsWith('https://discord.com/api/webhooks/')) {
        alert('ERROR: ENLACE DE WEBHOOK NO V√ÅLIDO');
        return;
      }
      
      localStorage.setItem('discordWebhookURL', url);
      document.getElementById('webhook-form').style.display = 'none';
      document.getElementById('dados-section').style.display = 'block';
    }

    function determinarResultado(puntos, tirada) {
      const porcentajeExito = puntos * 20;
      const umbrales = [
        { 
          max: 20, 
          texto: "FALLO CR√çTICO üí• ¬°SISTEMA COLAPSADO!", 
          descripcion: "La acci√≥n ha fallado catastr√≥ficamente con consecuencias graves.",
          clase: "critical"
        },
        { 
          max: 40, 
          texto: "FALLO T√âCNICO üõ†Ô∏è", 
          descripcion: "El intento no tuvo √©xito pero sin da√±os colaterales.",
          clase: "failure"
        },
        { 
          max: 60, 
          texto: "√âXITO PARCIAL ‚ö°", 
          descripcion: "Logro conseguido pero con complicaciones.",
          clase: "partial"
        },
        { 
          max: 80, 
          texto: "√âXITO TOTAL ‚úÖ", 
          descripcion: "La operaci√≥n se complet√≥ seg√∫n lo planeado.",
          clase: "success"
        },
        { 
          max: 100, 
          texto: "√âXITO SOBRESALIENTE üöÄ", 
          descripcion: "Resultado excepcional con beneficios adicionales.",
          clase: "epic"
        }
      ];
      
      const porcentajeReal = puntos >= 5 ? 100 : porcentajeExito;
      const porcentajeObtenido = (tirada / 20) * 100;
      const porcentajeEfectivo = (porcentajeObtenido * porcentajeReal) / 100;
      
      for (let umbral of umbrales) {
        if (porcentajeEfectivo <= umbral.max) {
          return {
            texto: umbral.texto,
            descripcion: umbral.descripcion,
            clase: umbral.clase,
            porcentaje: Math.round(porcentajeEfectivo)
          };
        }
      }
      
      return {
        texto: "√âXITO SOBRESALIENTE üöÄ",
        descripcion: "Resultado excepcional con beneficios adicionales.",
        clase: "epic",
        porcentaje: 100
      };
    }

    function getSkillResultMessage(skill, resultado) {
      const messages = {
        "Piloto ‚úàÔ∏è": [
          "¬°Impacto inminente!",
          "Error de navegaci√≥n",
          "Aterrizaje forzoso",
          "Vuelo estable",
          "¬°Acrobacias espaciales perfectas!"
        ],
        "Combate üî´": [
          "¬°Arma encasquillada!",
          "Disparo errado",
          "Da√±o parcial",
          "Blanco neutralizado",
          "¬°Disparo cr√≠tico!"
        ],
        "T√©cnico üõ†Ô∏è": [
          "¬°Sobrecarga del sistema!",
          "Reparaci√≥n fallida",
          "Funcionamiento limitado",
          "Sistema operativo",
          "¬°Optimizaci√≥n perfecta!"
        ],
        "Carisma üó£Ô∏è": [
          "Ofensa grave",
          "Malentendido",
          "Acuerdo parcial",
          "Negociaci√≥n exitosa",
          "¬°Persuasi√≥n magistral!"
        ],
        "Supervivencia üåç": [
          "¬°Situaci√≥n cr√≠tica!",
          "Error de c√°lculo",
          "Supervivencia dif√≠cil",
          "Recursos suficientes",
          "¬°Adaptaci√≥n perfecta!"
        ],
        "Comercio üì¶": [
          "¬°Estafa detectada!",
          "P√©rdida econ√≥mica",
          "Ganancia modesta",
          "Buena inversi√≥n",
          "¬°Negocio del siglo!"
        ]
      };
      
      const index = Math.floor(resultado.porcentaje / 20);
      return messages[skill][Math.min(index, 4)];
    }

    async function tirarDados() {
      const webhookURL = localStorage.getItem('discordWebhookURL');
      const characterName = document.getElementById('character-name').value.trim();
      const skillName = document.getElementById('skill-name').value;
      const skillPoints = parseInt(document.getElementById('skill-points').value);
      
      // Validaciones
      if (!webhookURL) {
        alert('ERROR: SISTEMA NO CONFIGURADO');
        return;
      }
      if (!characterName) {
        alert('ERROR: NOMBRE NO ESPECIFICADO');
        return;
      }
      if (skillPoints < 1 || skillPoints > 6) {
        alert('ERROR: NIVEL DE HABILIDAD INV√ÅLIDO');
        return;
      }
      
      // Calcular tirada
      const tirada = Math.floor(Math.random() * 20) + 1;
      const resultado = determinarResultado(skillPoints, tirada);
      const skillMessage = getSkillResultMessage(skillName, resultado);
      
      // Mostrar resultado local
      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'block';
      resultDiv.className = resultado.clase;
      resultDiv.innerHTML = `
        <h3>üìä RESULTADO DE SIMULACI√ìN</h3>
        <p><strong>${characterName}</strong> en <strong>${skillName}</strong> (Nivel ${skillPoints})</p>
        <p>üé≤ Tirada: ${tirada}/20</p>
        <p>üìà Eficiencia: ${resultado.porcentaje}%</p>
        <p>üí¨ <strong>${skillMessage}</strong></p>
        <p>${resultado.descripcion}</p>
        <p class="${resultado.clase}">${resultado.texto}</p>
      `;
      
      // Enviar a Discord
      const mensaje = {
        content: `**üåü [CCBE] INFORME DE HABILIDAD**  
                  **Piloto:** ${characterName}  
                  **Habilidad:** ${skillName} (Nivel ${skillPoints})  
                  **Tirada:** ${tirada}/20 ‚Üí **${resultado.texto}**  
                  **Eficiencia:** ${resultado.porcentaje}%  
                  **Resultado:** ${skillMessage}  
                  **An√°lisis:** ${resultado.descripcion}  
                  **‚ñ∫ RECOMENDACI√ìN:** ${skillPoints >= 5 ? "¬°Habilidad de √©lite!" : "Requiere m√°s entrenamiento."}`
      };

      try {
        const response = await fetch(webhookURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(mensaje)
        });
        
        if (!response.ok) {
          console.error("Error al enviar a Discord");
        }
      } catch (error) {
        console.error("Error:", error);
      }
    }
  </script>
</body>
</html>