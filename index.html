<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.5.5"><link rel="icon" type="image/svg+xml" href="/dados-bot/favicon.svg"><link rel="stylesheet" href="../styles/global.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Stencil:opsz,wght@10..72,100..900&display=swap" rel="stylesheet"><title>3D20</title><link rel="stylesheet" href="/dados-bot/_astro/index.BlitW18A.css"></head> <body> <main>  <div class="container"> <div class="row"> <div class="header-content"> <div class="header-content__left"> <button id="backwhurl" onclick="resetWebhookConfig()">Nuevo Webhook</button> </div> <div class="header-content__right"> <div class="header-content__right--info"> <button onclick="document.getElementById('modalInfoCustomJson').showModal()"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"> <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path> </svg> </button> <dialog id="modalInfoCustomJson"> <div> <h2>Formato de JSON para Skills Personalizadas</h2> <p>El archivo JSON debe tener el siguiente formato:</p> <pre class="pre">{
  &quot;config&quot;: {
    &quot;title&quot;: &quot;üåü INFORME DEL SALOON&quot;,
    &quot;characterLabel&quot;: &quot;Cowboy&quot;,
    &quot;defaultAnalysis&quot;: &quot;El vaquero reaccion√≥ como pudo&quot;,
    &quot;defaultRecommendation&quot;: &quot;M√°s pr√°ctica en el saloon&quot;
  },
  &quot;skills&quot;: [
    {
      &quot;name&quot;: &quot;Tiro r√°pido ü§†&quot;,
      &quot;messages&quot;: [
        &quot;¬°El rev√≥lver se encasquill√≥!&quot;,
        &quot;Disparo al aire&quot;,
        &quot;Roz√≥ al oponente&quot;,
        &quot;Disparo certero&quot;,
        &quot;¬°Disparo legendario!&quot;
      ],
      &quot;analysis&quot;: [
        &quot;Desastre total en el duelo&quot;,
        &quot;Necesita practicar m√°s&quot;,
        &quot;Casi lo logra&quot;,
        &quot;Buen trabajo&quot;,
        &quot;¬°Leyenda del Oeste!&quot;
      ],
      &quot;recommendations&quot;: [
        &quot;Ve a ver al herrero&quot;,
        &quot;Entrena con el sheriff&quot;,
        &quot;Un poco m√°s de pr√°ctica&quot;,
        &quot;Sigue as√≠&quot;,
        &quot;¬°Eres una leyenda!&quot;
      ]
    }
  ]
} 
          </pre> <div class="header-content__right--dialog-buttons"> <button onclick="copiarJsonBase()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 icon ml-auto" title="copiar"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"> <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"></path> </svg> </button> <button onclick="document.getElementById('modalInfoCustomJson').close()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 icon ml-5" title="Cerrar"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path> </svg> </button> </div> </div> </dialog> </div> <div class="header-content__right--load"> <label for="loadJson" class="button flex justify-between"> <span>Custom Upload</span> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15"></path> </svg> </label> <input id="loadJson" type="file" accept=".json,application/json"> </div> </div> </div> <div class="main-content"> <div class="main-content__webhookForm" id="webhook-form"> <h3>‚öô CONFIGURACI√ìN DEL SISTEMA</h3> <div class="main-content__webhookForm--group form-group"> <label for="webhook-url">ENLACE DE DISCORD WEBHOOK:</label> <input type="password" id="webhook-url" placeholder="https://discord.com/api/webhooks/..."> </div> <button onclick="guardarWebhook()">INICIAR SISTEMA</button> </div> <div class="main-content__dadosSection" id="dados-section" style="display: none"> <div class="main-content__dadosSection--group form-group"> <label for="character-name">JUGADOR</label> <input type="text" id="character-name" placeholder="Ej: CMDR Shepard"> </div> <div class="main-content__dadosSection--group form-group"> <label for="skill-name">HABILIDAD:</label> <select id="skill-name"> <option value="Piloto ‚úàÔ∏è">Piloto ‚úàÔ∏è</option> <option value="Combate üî´">Combate üî´</option> <option value="T√©cnico üõ†Ô∏è">T√©cnico üõ†Ô∏è</option> <option value="Carisma üó£Ô∏è">Carisma üó£Ô∏è</option> <option value="Supervivencia üåç">Supervivencia üåç</option> <option value="Comercio üì¶">Comercio üì¶</option> </select> </div> <div class="main-content__dadosSection--group form-group"> <label for="skill-points">NIVEL DE HABILIDAD (1-6):</label> <input type="number" id="skill-points" min="1" max="6" value="3"> </div> <div class="content" data-astro-cid-nqdiz4ou> <div class="dice" data-astro-cid-nqdiz4ou> <figure class="face face-1" data-astro-cid-nqdiz4ou></figure> <figure class="face face-2" data-astro-cid-nqdiz4ou></figure> <figure class="face face-3" data-astro-cid-nqdiz4ou></figure> <figure class="face face-4" data-astro-cid-nqdiz4ou></figure> <figure class="face face-5" data-astro-cid-nqdiz4ou></figure> <figure class="face face-6" data-astro-cid-nqdiz4ou></figure> <figure class="face face-7" data-astro-cid-nqdiz4ou></figure> <figure class="face face-8" data-astro-cid-nqdiz4ou></figure> <figure class="face face-9" data-astro-cid-nqdiz4ou></figure> <figure class="face face-10" data-astro-cid-nqdiz4ou></figure> <figure class="face face-11" data-astro-cid-nqdiz4ou></figure> <figure class="face face-12" data-astro-cid-nqdiz4ou></figure> <figure class="face face-13" data-astro-cid-nqdiz4ou></figure> <figure class="face face-14" data-astro-cid-nqdiz4ou></figure> <figure class="face face-15" data-astro-cid-nqdiz4ou></figure> <figure class="face face-16" data-astro-cid-nqdiz4ou></figure> <figure class="face face-17" data-astro-cid-nqdiz4ou></figure> <figure class="face face-18" data-astro-cid-nqdiz4ou></figure> <figure class="face face-19" data-astro-cid-nqdiz4ou></figure> <figure class="face face-20" data-astro-cid-nqdiz4ou></figure> </div> <a href="" class="randomize" data-astro-cid-nqdiz4ou></a> </div> <script>
    const dice = document.querySelector(".dice");
    let timeoutId;
    const animationDuration = 3000;

    // Funci√≥n para girar el dado y obtener un n√∫mero aleatorio
    function rollDice() {
        return new Promise((resolve) => {
            dice.classList.add("rolling");
            clearTimeout(timeoutId);

            timeoutId = setTimeout(() => {
                dice.classList.remove("rolling");
                // Obtener el n√∫mero aleatorio (1-20)
                const result = Math.floor(Math.random() * 20) + 1;
                
                // Mostrar el n√∫mero en la cara visible
                const visibleFace = Array.from(dice.children)
                    .find(face => window.getComputedStyle(face).visibility === 'visible');
                if (visibleFace) {
                    // Crear un span si no existe
                    let span = visibleFace.querySelector('span');
                    if (!span) {
                        span = document.createElement('span');
                        visibleFace.appendChild(span);
                    }
                    span.textContent = result;
                }
                
                resolve(result);
            }, animationDuration);
        });
    }

    // Manejo de clics en randomize y el dado
    document.querySelectorAll(".randomize, .dice").forEach(element => {
        element.addEventListener("click", async function(e) {
            e.preventDefault();
            
            // Obtener los datos del formulario
            const characterName = document.getElementById('character-name').value;
            const skillName = document.getElementById('skill-name').value;
            const skillPoints = parseInt(document.getElementById('skill-points').value);
            
            // Verificar que hay un webhook configurado
            const webhookURL = localStorage.getItem("discordWebhookURL");
            if (!webhookURL) {
                alert("ERROR: SISTEMA NO CONFIGURADO");
                return;
            }
            
            if (!characterName) {
                alert("ERROR: NOMBRE NO ESPECIFICADO");
                return;
            }

            if (skillPoints < 1 || skillPoints > 6) {
                alert("ERROR: NIVEL DE HABILIDAD INV√ÅLIDO");
                return;
            }

            // Tirar el dado 3 veces
            const results = [];
            for (let i = 0; i < 3; i++) {
                const result = await rollDice();
                results.push(result);
            }

            // Determinar el resultado final
            const tirada = results.reduce((a, b) => a + parseInt(b), 0) / 3; // Promedio de los 3 tiros
            const resultado = determinarResultado(skillPoints, tirada);
            const skill = currentSkills.find((s) => s.name === skillName) || {};

            // Obtener mensajes personalizados
            const resultIndex = Math.min(Math.floor(resultado.porcentaje / 20), 4);
            const skillMessage =
                skill.messages?.[resultIndex] || "Resultado no definido";
            const analysis =
                skill.analysis?.[resultIndex] || currentConfig.defaultAnalysis;
            const recommendation =
                skill.recommendations?.[resultIndex] ||
                currentConfig.defaultRecommendation;

            // Mostrar los resultados en pantalla
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="result-item">
                    <h4>üåü INFORME DE HABILIDAD</h4>
                    <p><strong>Personaje:</strong> ${characterName}</p>
                    <p><strong>Habilidad:</strong> ${skillName} (Nivel ${skillPoints})</p>
                    <p><strong>Tirada:</strong> ${tirada.toFixed(1)}/20 ‚Üí <strong>${resultado.texto}</strong></p>
                    <p><strong>Eficiencia:</strong> ${resultado.porcentaje}%</p>
                    <p><strong>Resultado:</strong> ${skillMessage}</p>
                    <p><strong>An√°lisis:</strong> ${analysis}</p>
                    <p><strong>‚ñ∫ RECOMENDACI√ìN:</strong> ${recommendation}</p>
                    <p><strong>Tiros:</strong> ${results.join(', ')}</p>
                </div>
            `;

            // Crear mensaje para Discord
            const discordMessage = [
                `**${currentConfig.title}**`,
                `**${currentConfig.characterLabel}:** ${characterName}`,
                `**Habilidad:** ${skillName} (Nivel ${skillPoints})`,
                `**Tirada:** ${tirada.toFixed(1)}/20 ‚Üí **${resultado.texto}**`,
                `**Eficiencia:** ${resultado.porcentaje}%`,
                `**Resultado:** ${skillMessage}`,
                `**An√°lisis:** ${analysis}`,
                `**‚ñ∫ RECOMENDACI√ìN:** ${recommendation}`,
                `**Tiros:** ${results.join(', ')}`
            ].join("\n");

            // Enviar a Discord
            try {
                const response = await fetch(webhookURL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        content: discordMessage,
                        allowed_mentions: { parse: [] },
                    }),
                });

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                console.log("Mensaje enviado con √©xito a Discord");
            } catch (error) {
                console.error("Error al enviar a Discord:", error);
                alert(
                    "Error al enviar a Discord. Verifica la consola para m√°s detalles."
                );
            }
        });
    });

    // Exportar la funci√≥n para que pueda ser llamada desde el componente padre
    window.rollDice = rollDice;
</script>  <div class="main-content__dadosSection--result" id="result"></div> </div> </div> </div> </div>  </main> </body></html> <script>
  // Configuraci√≥n inicial
  let currentConfig = {
    title: "üåü INFORME DE HABILIDAD",
    characterLabel: "Personaje",
    defaultAnalysis: "Resultado est√°ndar de la acci√≥n",
    defaultRecommendation: "Sigue practicando para mejorar",
  };

  let currentSkills = [
    {
      name: "Piloto ‚úàÔ∏è",
      messages: [
        "¬°Impacto inminente!",
        "Error de navegaci√≥n",
        "Aterrizaje forzoso",
        "Vuelo estable",
        "¬°Acrobacias espaciales perfectas!",
      ],
      analysis: [
        "Desastre total en el vuelo",
        "Necesita m√°s horas de pr√°ctica",
        "Aterrizaje aceptable",
        "Vuelo controlado",
        "Maniobras perfectas",
      ],
      recommendations: [
        "Revisar manual de vuelo",
        "Practicar en simulador",
        "Tomar lecciones adicionales",
        "Mantener el buen trabajo",
        "¬°Eres un as del aire!",
      ],
    },
    {
      name: "Combate üî´",
      messages: [
        "¬°Arma encasquillada!",
        "Disparo errado",
        "Da√±o parcial",
        "Blanco neutralizado",
        "¬°Disparo cr√≠tico!",
      ],
      analysis: [
        "Fallo catastr√≥fico",
        "Necesita entrenamiento",
        "Resultado aceptable",
        "Buen desempe√±o",
        "Excelente punter√≠a",
      ],
      recommendations: [
        "Revisar el arma",
        "Practicar punter√≠a",
        "Mejorar t√©cnica",
        "Mantener precisi√≥n",
        "¬°Eres un francotirador!",
      ],
    },
  ];

  // Verificaci√≥n inicial al cargar la p√°gina
  document.addEventListener("DOMContentLoaded", function () {
    const webhookURL = localStorage.getItem("discordWebhookURL");
    const backButton = document.getElementById("backwhurl");
    const webhookForm = document.getElementById("webhook-form");
    const dadosSection = document.getElementById("dados-section");

    if (webhookURL) {
      webhookForm.style.display = "none";
      dadosSection.style.display = "block";
      backButton.style.display = "block";

      // Actualizar dropdown con habilidades actuales
      actualizarDropdownHabilidades();
    } else {
      webhookForm.style.display = "block";
      dadosSection.style.display = "none";
      backButton.style.display = "none";
    }
  });

  function resetWebhookConfig() {
    // Limpiar el webhook almacenado
    localStorage.removeItem("discordWebhookURL");

    // Restablecer el campo de URL
    document.getElementById("webhook-url").value = "";

    // Mostrar el formulario de configuraci√≥n
    document.getElementById("webhook-form").style.display = "block";

    // Ocultar la secci√≥n de habilidades
    document.getElementById("dados-section").style.display = "none";

    // Ocultar el bot√≥n "Nuevo Webhook"
    document.getElementById("backwhurl").style.display = "none";

    // Limpiar resultados anteriores
    document.getElementById("result").style.display = "none";
  }

  function actualizarDropdownHabilidades() {
    const skillSelect = document.getElementById("skill-name");
    skillSelect.innerHTML = ""; // Limpiar opciones existentes

    currentSkills.forEach((skill) => {
      const option = document.createElement("option");
      option.value = skill.name;
      option.textContent = skill.name;
      skillSelect.appendChild(option);
    });
  }

  function guardarWebhook() {
    const url = document.getElementById("webhook-url").value.trim();

    if (!url.startsWith("https://discord.com/api/webhooks/")) {
      alert("ERROR: ENLACE DE WEBHOOK NO V√ÅLIDO");
      return;
    }

    localStorage.setItem("discordWebhookURL", url);
    document.getElementById("webhook-form").style.display = "none";
    document.getElementById("dados-section").style.display = "block";
    document.getElementById("backwhurl").style.display = "block";

    // Limpiar campo de nombre de personaje para nueva simulaci√≥n
    document.getElementById("character-name").value = "";
  }

  document.getElementById("loadJson").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const config = JSON.parse(e.target.result);

        // Actualizar configuraci√≥n general
        if (config.config) {
          currentConfig = {
            ...currentConfig,
            ...config.config,
          };
        }

        // Actualizar habilidades
        if (config.skills && Array.isArray(config.skills)) {
          currentSkills = config.skills;
          actualizarDropdownHabilidades();
        }

        alert("Configuraci√≥n personalizada cargada correctamente");
      } catch (error) {
        alert("Error: El archivo JSON no es v√°lido\n" + error.message);
        console.error(error);
      }
    };
    reader.readAsText(file);
  });

  function copiarJsonBase() {
    const jsonBase = JSON.stringify(
      {
        config: currentConfig,
        skills: currentSkills,
      },
      null,
      2
    );

    navigator.clipboard
      .writeText(jsonBase)
      .then(() => alert("JSON base copiado al portapeles"))
      .catch((err) => console.error("Error al copiar:", err));
  }

  function determinarResultado(puntos, tirada) {
    const porcentajeExito = puntos * 20;
    const umbrales = [
      {
        max: 20,
        texto: "FALLO CR√çTICO üí• ¬°SISTEMA COLAPSADO!",
        descripcion:
          "La acci√≥n ha fallado catastr√≥ficamente con consecuencias graves.",
        clase: "critical",
      },
      {
        max: 40,
        texto: "FALLO T√âCNICO üõ†Ô∏è",
        descripcion: "El intento no tuvo √©xito pero sin da√±os colaterales.",
        clase: "failure",
      },
      {
        max: 60,
        texto: "√âXITO PARCIAL ‚ö°",
        descripcion: "Logro conseguido pero con complicaciones.",
        clase: "partial",
      },
      {
        max: 80,
        texto: "√âXITO TOTAL ‚úÖ",
        descripcion: "La operaci√≥n se complet√≥ seg√∫n lo planeado.",
        clase: "success",
      },
      {
        max: 100,
        texto: "√âXITO SOBRESALIENTE üöÄ",
        descripcion: "Resultado excepcional con beneficios adicionales.",
        clase: "epic",
      },
    ];

    const porcentajeReal = puntos >= 5 ? 100 : porcentajeExito;
    const porcentajeObtenido = (tirada / 20) * 100;
    const porcentajeEfectivo = (porcentajeObtenido * porcentajeReal) / 100;

    for (let umbral of umbrales) {
      if (porcentajeEfectivo <= umbral.max) {
        return {
          texto: umbral.texto,
          descripcion: umbral.descripcion,
          clase: umbral.clase,
          porcentaje: Math.round(porcentajeEfectivo),
        };
      }
    }

    return {
      texto: "√âXITO SOBRESALIENTE üöÄ",
      descripcion: "Resultado excepcional con beneficios adicionales.",
      clase: "epic",
      porcentaje: 100,
    };
  }

  async function tirarDados() {
    const webhookURL = localStorage.getItem("discordWebhookURL");
    if (!webhookURL) {
      alert("ERROR: SISTEMA NO CONFIGURADO");
      return;
    }

    const characterName = document
      .getElementById("character-name")
      .value.trim();
    if (!characterName) {
      alert("ERROR: NOMBRE NO ESPECIFICADO");
      return;
    }

    const skillPoints = parseInt(document.getElementById("skill-points").value);
    if (skillPoints < 1 || skillPoints > 6) {
      alert("ERROR: NIVEL DE HABILIDAD INV√ÅLIDO");
      return;
    }

    const skillName = document.getElementById("skill-name").value;
    const tirada = Math.floor(Math.random() * 20) + 1;
    const resultado = determinarResultado(skillPoints, tirada);
    const skill = currentSkills.find((s) => s.name === skillName) || {};

    // Obtener mensajes personalizados
    const resultIndex = Math.min(Math.floor(resultado.porcentaje / 20), 4);
    const skillMessage =
      skill.messages?.[resultIndex] || "Resultado no definido";
    const analysis =
      skill.analysis?.[resultIndex] || currentConfig.defaultAnalysis;
    const recommendation =
      skill.recommendations?.[resultIndex] ||
      currentConfig.defaultRecommendation;

    // Mostrar resultado local
    const resultDiv = document.getElementById("result");
    resultDiv.style.display = "block";
    resultDiv.className = resultado.clase;
    resultDiv.innerHTML = `
      <h3>üìä RESULTADO DE SIMULACI√ìN</h3>
      <p><strong>${characterName}</strong> en <strong>${skillName}</strong> (Nivel ${skillPoints})</p>
      <p>üé≤ Tirada: ${tirada}/20</p>
      <p>üìà Eficiencia: ${resultado.porcentaje}%</p>
      <p>üí¨ <strong>${skillMessage}</strong></p>
      <p>${analysis}</p>
      <p class="${resultado.clase}">${resultado.texto}</p>
      <p>‚ñ∫ RECOMENDACI√ìN: ${recommendation}</p>
    `;

    // Crear mensaje para Discord (formato mejorado)
    const discordMessage = [
      `**${currentConfig.title}**`,
      `**${currentConfig.characterLabel}:** ${characterName}`,
      `**Habilidad:** ${skillName} (Nivel ${skillPoints})`,
      `**Tirada:** ${tirada}/20 ‚Üí **${resultado.texto}**`,
      `**Eficiencia:** ${resultado.porcentaje}%`,
      `**Resultado:** ${skillMessage}`,
      `**An√°lisis:** ${analysis}`,
      `**‚ñ∫ RECOMENDACI√ìN:** ${recommendation}`,
    ].join("\n");

    // Enviar a Discord
    try {
      const response = await fetch(webhookURL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          content: discordMessage,
          allowed_mentions: { parse: [] },
        }),
      });

      if (!response.ok) {
        throw new Error(`Error HTTP: ${response.status}`);
      }

      console.log("Mensaje enviado con √©xito a Discord");
    } catch (error) {
      console.error("Error al enviar a Discord:", error);
      alert(
        "Error al enviar a Discord. Verifica la consola para m√°s detalles."
      );
    }
  }
</script>